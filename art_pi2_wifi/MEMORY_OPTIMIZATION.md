# å†…å­˜ä¼˜åŒ–æŒ‡å—

## é—®é¢˜æè¿°

å¦‚æœä½ é‡åˆ°ç±»ä¼¼é”™è¯¯ï¼š
```
[E/web.client] Failed to allocate receive buffer
```

è¿™è¯´æ˜ç³»ç»Ÿå¯ç”¨å†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…HTTPå“åº”ç¼“å†²åŒºã€‚

## âœ… å·²åº”ç”¨çš„ä¼˜åŒ–

æˆ‘å·²ç»è¿›è¡Œäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š

### 1. å‡å°ç¼“å†²åŒºå¤§å°

**ä¿®æ”¹å‰ï¼š**
```c
#define HTTP_RESPONSE_MAX   (64 * 1024)  // 64KB
```

**ä¿®æ”¹åï¼š**
```c
#define HTTP_RESPONSE_MAX   (32 * 1024)  // 32KB
```

### 2. æ·»åŠ å†…å­˜æ£€æŸ¥å·¥å…·

æ–°å¢äº† `memory_helper.c` æä¾› `meminfo` å‘½ä»¤ã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé‡æ–°ç¼–è¯‘ï¼ˆæ¨èï¼‰

```bash
# æ¸…ç†æ—§æ–‡ä»¶
scons -c

# é‡æ–°ç¼–è¯‘ï¼ˆä½¿ç”¨ä¼˜åŒ–åçš„ä»£ç ï¼‰
scons -j8

# ä¸‹è½½åˆ°å¼€å‘æ¿
```

### æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å†…å­˜ä½¿ç”¨

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ
msh> free

# æˆ–ä½¿ç”¨è¯¦ç»†ä¿¡æ¯
msh> meminfo
```

### æ–¹æ¡ˆ3ï¼šé‡Šæ”¾å†…å­˜

å¦‚æœå†…å­˜ä»ç„¶ä¸è¶³ï¼Œå°è¯•ï¼š

```bash
# 1. åœæ­¢ä¸å¿…è¦çš„æœåŠ¡
msh> va_stop              # åœæ­¢è¯­éŸ³åŠ©æ‰‹

# 2. é‡å¯ç³»ç»Ÿï¼ˆæœ€æœ‰æ•ˆï¼‰
msh> reboot

# 3. é‡è¯•AIæµ‹è¯•
msh> ai_say ä½ å¥½
```

## ğŸ“Š å†…å­˜éœ€æ±‚

å„åŠŸèƒ½çš„å…¸å‹å†…å­˜éœ€æ±‚ï¼š

| åŠŸèƒ½ | å†…å­˜éœ€æ±‚ | è¯´æ˜ |
|------|---------|------|
| HTTPç¼“å†²åŒº | 32 KB | AIé€šä¿¡å¿…éœ€ |
| éŸ³é¢‘ç¼“å†²åŒº | 16 KB | å½•éŸ³/æ’­æ”¾ |
| è¯­éŸ³åŠ©æ‰‹ | 4 KB | æ§åˆ¶ç»“æ„ |
| æ ˆç©ºé—´ | 8-16 KB | çº¿ç¨‹æ ˆ |
| **æ€»è®¡** | **~60 KB** | æœ€ä½è¦æ±‚ |

å»ºè®®ç³»ç»Ÿè‡³å°‘æœ‰ **128 KB** å¯ç”¨RAMã€‚

## ğŸ¯ è¿›ä¸€æ­¥ä¼˜åŒ–é€‰é¡¹

### é€‰é¡¹1ï¼šå‡å°éŸ³é¢‘ç¼“å†²åŒº

ç¼–è¾‘ `audio_capture.h`ï¼š

```c
// ä» 16KB å‡å°åˆ° 8KB
#define AUDIO_BUFFER_SIZE  (1024 * 8)  
```

### é€‰é¡¹2ï¼šå‡å°HTTPç¼“å†²åŒºï¼ˆå¦‚æœ32KBè¿˜ä¸å¤Ÿï¼‰

ç¼–è¾‘ `web_client.c`ï¼š

```c
// ä» 32KB å‡å°åˆ° 16KB
#define HTTP_RESPONSE_MAX   (16 * 1024)
```

âš ï¸ **æ³¨æ„**ï¼šå¤ªå°çš„ç¼“å†²åŒºå¯èƒ½å¯¼è‡´AIå“åº”è¢«æˆªæ–­ã€‚

### é€‰é¡¹3ï¼šç¦ç”¨éƒ¨åˆ†åŠŸèƒ½

ç¼–è¾‘ `voice_assistant_config.h`ï¼š

```c
// ç¦ç”¨å”¤é†’è¯æ£€æµ‹ï¼ˆèŠ‚çœå†…å­˜ï¼‰
#define VOICE_WAKEUP_ENABLE     0

// ç¦ç”¨éŸ³é¢‘æ–‡ä»¶ä¿å­˜
#define VOICE_SAVE_AUDIO_FILE   0
```

### é€‰é¡¹4ï¼šä¼˜åŒ–ç¼–è¯‘é€‰é¡¹

åœ¨ `rtconfig.py` ä¸­ï¼š

```python
# å¯ç”¨ç¼–è¯‘ä¼˜åŒ–
CFLAGS = ' -Os'  # ä¼˜åŒ–ä»£ç å¤§å°
```

## ğŸ” è¯Šæ–­æ­¥éª¤

### 1. æ£€æŸ¥å½“å‰å†…å­˜

```bash
msh> free

# è¾“å‡ºç¤ºä¾‹ï¼š
total    : 262144
used     : 102400
free     : 159744
```

å¦‚æœ `free` å°äº 64KBï¼Œå†…å­˜ä¸è¶³ï¼

### 2. æŸ¥çœ‹çº¿ç¨‹å ç”¨

```bash
msh> list_thread

# æ£€æŸ¥å„çº¿ç¨‹çš„æ ˆå¤§å°
```

### 3. æµ‹è¯•åˆ†é…

```bash
# é‡æ–°ç¼–è¯‘åæµ‹è¯•
msh> ai_say æµ‹è¯•
```

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯1ï¼šå†…å­˜åˆ†é…å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
[E/web.client] Failed to allocate receive buffer (32768 bytes)
Available memory insufficient. Run 'free' command to check
```

**è§£å†³ï¼š**
1. è¿è¡Œ `free` æ£€æŸ¥å¯ç”¨å†…å­˜
2. å¦‚æœä¸è¶³ï¼Œé‡å¯ç³»ç»Ÿï¼š`reboot`
3. æˆ–å‡å°ç¼“å†²åŒºå¤§å°

### é”™è¯¯2ï¼šå†…å­˜ç¢ç‰‡

**ç—‡çŠ¶ï¼š**
`free` æ˜¾ç¤ºæœ‰è¶³å¤Ÿå†…å­˜ï¼Œä½†ä»ç„¶åˆ†é…å¤±è´¥

**åŸå› ï¼š**
å†…å­˜ç¢ç‰‡åŒ–ï¼Œæ²¡æœ‰è¿ç»­çš„å¤§å—å†…å­˜

**è§£å†³ï¼š**
```bash
# é‡å¯ç³»ç»Ÿæ¸…ç†å†…å­˜ç¢ç‰‡
msh> reboot
```

### é”™è¯¯3ï¼šå†…å­˜æ³„æ¼

**ç—‡çŠ¶ï¼š**
è¿è¡Œä¸€æ®µæ—¶é—´åå¯ç”¨å†…å­˜æŒç»­å‡å°‘

**è§£å†³ï¼š**
```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
msh> va_stop

# 2. æ£€æŸ¥å†…å­˜
msh> free

# 3. å¦‚æœå†…å­˜æœªé‡Šæ”¾ï¼Œé‡å¯
msh> reboot
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç›‘æ§å†…å­˜ä½¿ç”¨

å®šæœŸè¿è¡Œï¼š
```bash
msh> free
```

### 2. åŠæ—¶æ¸…ç†

ä¸ä½¿ç”¨æ—¶åœæ­¢æœåŠ¡ï¼š
```bash
msh> va_stop
msh> wakeup_stop
```

### 3. é¿å…é•¿æ—¶é—´è¿è¡Œ

å®šæœŸé‡å¯ç³»ç»Ÿä»¥æ¸…ç†å†…å­˜ï¼š
```bash
# æ¯è¿è¡Œæ•°å°æ—¶åé‡å¯
msh> reboot
```

### 4. ä¼˜å…ˆçº§è®¾ç½®

é‡è¦åŠŸèƒ½ä¼˜å…ˆä¿è¯å†…å­˜ï¼š
- AIé€šä¿¡ > éŸ³é¢‘é‡‡é›† > å”¤é†’è¯æ£€æµ‹

## ğŸ“ é…ç½®å»ºè®®

### æœ€å°é…ç½®ï¼ˆä½å†…å­˜ç³»ç»Ÿï¼‰

```c
// voice_assistant_config.h
#define VOICE_WAKEUP_ENABLE     0    // ç¦ç”¨å”¤é†’è¯
#define VOICE_RECORD_DURATION   3    // å‡å°‘å½•éŸ³æ—¶é•¿
#define VOICE_BUFFER_SIZE       (16000 * 2 * 3)  // 3ç§’éŸ³é¢‘

// web_client.c
#define HTTP_RESPONSE_MAX   (16 * 1024)  // 16KB

// audio_capture.h
#define AUDIO_BUFFER_SIZE   (1024 * 8)   // 8KB
```

### æ ‡å‡†é…ç½®ï¼ˆå½“å‰è®¾ç½®ï¼‰

```c
// voice_assistant_config.h
#define VOICE_WAKEUP_ENABLE     1    // å¯ç”¨å”¤é†’è¯
#define VOICE_RECORD_DURATION   5    // 5ç§’å½•éŸ³
#define VOICE_BUFFER_SIZE       (16000 * 2 * 5)

// web_client.c
#define HTTP_RESPONSE_MAX   (32 * 1024)  // 32KB âœ… å·²ä¼˜åŒ–

// audio_capture.h
#define AUDIO_BUFFER_SIZE   (1024 * 16)  // 16KB
```

### å®Œæ•´é…ç½®ï¼ˆé«˜å†…å­˜ç³»ç»Ÿï¼‰

```c
// voice_assistant_config.h
#define VOICE_WAKEUP_ENABLE     1
#define VOICE_RECORD_DURATION   10   // 10ç§’å½•éŸ³

// web_client.c
#define HTTP_RESPONSE_MAX   (64 * 1024)  // 64KB

// audio_capture.h
#define AUDIO_BUFFER_SIZE   (1024 * 32)  // 32KB
```

## ğŸ”„ ç°åœ¨å°±è¯•è¯•

### æ­¥éª¤1ï¼šé‡æ–°ç¼–è¯‘

```bash
cd /path/to/project
scons -c
scons -j8
```

### æ­¥éª¤2ï¼šä¸‹è½½å¹¶è¿è¡Œ

ä¸‹è½½å›ºä»¶åˆ°å¼€å‘æ¿

### æ­¥éª¤3ï¼šæµ‹è¯•

```bash
# æ£€æŸ¥å†…å­˜
msh> free

# æµ‹è¯•AIæœåŠ¡
msh> ai_say ä½ å¥½ä¸–ç•Œ
```

## âœ… é¢„æœŸç»“æœ

ä¼˜åŒ–åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```bash
msh> ai_say ä½ å¥½ä¸–ç•Œ

========================================
[You] ä½ å¥½ä¸–ç•Œ
========================================
[I/ai.test] Sending text to AI: ä½ å¥½ä¸–ç•Œ
[D/web.client] Allocated 32768 bytes for HTTP response  âœ…
[I/ai.cloud] Starting text to speech: ä½ å¥½ä¸–ç•Œ
[I/ai.cloud] Text to speech successful (audio_len: 12800)
[AI] Processing completed!
Audio data received: 12800 bytes
Playing audio...
Playback completed!
========================================
```

## ğŸ“ ä»ç„¶æœ‰é—®é¢˜ï¼Ÿ

å¦‚æœä¼˜åŒ–åä»ç„¶å¤±è´¥ï¼š

1. **æ£€æŸ¥ç³»ç»ŸRAMå¤§å°**
   - ç¡®è®¤å¼€å‘æ¿è‡³å°‘æœ‰ 128KB RAM
   - æŸ¥çœ‹äº§å“æ‰‹å†Œ

2. **æ£€æŸ¥å…¶ä»–æœåŠ¡**
   ```bash
   list_thread    # æŸ¥çœ‹æ‰€æœ‰çº¿ç¨‹
   ```

3. **è”ç³»æ”¯æŒ**
   - æä¾› `free` å‘½ä»¤è¾“å‡º
   - æä¾›å®Œæ•´çš„é”™è¯¯æ—¥å¿—
   - è¯´æ˜å¼€å‘æ¿å‹å·

---

**é‡æ–°ç¼–è¯‘åï¼Œå†…å­˜é—®é¢˜åº”è¯¥å¾—åˆ°æ”¹å–„ï¼** ğŸš€

