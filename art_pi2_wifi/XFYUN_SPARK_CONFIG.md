# 讯飞星火大模型配置指南

## 🌟 为什么选择讯飞星火

- ✅ **API超级简单**（比百度简单10倍）
- ✅ **中文效果最好**（专门为中文优化）
- ✅ **免费额度充足**（200万tokens/月）
- ✅ **国内直连**（无需翻墙，速度快）
- ✅ **一站式语音方案**（可以直接用讯飞的语音识别和TTS）

---

## 📝 获取讯飞星火密钥

### 步骤1：注册讯飞账号

访问：https://www.xfyun.cn/

点击右上角"注册"，使用手机号注册。

### 步骤2：实名认证

1. 登录后，点击右上角头像
2. 进入"个人中心"
3. 完成实名认证（需要身份证）

**注意：** 实名认证后才能使用API

### 步骤3：创建应用

1. **访问控制台**
   https://console.xfyun.cn/

2. **点击"创建应用"或"我的应用"**

3. **填写应用信息：**
   - 应用名称：`语音助手`
   - 应用平台：`WebAPI`
   - 应用类型：`个人开发`

4. **点击"创建"**

### 步骤4：获取密钥

创建应用后，在"我的应用"页面会显示：

```
┌────────────────────────────────────────┐
│ 应用：语音助手                          │
├────────────────────────────────────────┤
│ APPID:      12345678                   │ ← 复制这个
│ APISecret:  abc123def456...            │ ← 复制这个
│ APIKey:     xyz789uvw012...            │ ← 复制这个
└────────────────────────────────────────┘
```

**复制这三个值！**

### 步骤5：开通星火大模型

1. 在控制台左侧菜单，找到"星火认知大模型"

2. 点击"立即使用"或"开通服务"

3. 选择版本：
   - **Spark 3.5**（推荐，免费）
   - Spark 3.0
   - Spark Lite

4. 同意协议，开通服务

---

## 🔧 配置到代理

### 修改 xfyun_proxy.py

打开 `xfyun_proxy.py`，修改第32-34行：

```python
XFYUN_APPID = "12345678"                      # 改为你的APPID
XFYUN_API_KEY = "xyz789uvw012..."             # 改为你的APIKey  
XFYUN_API_SECRET = "abc123def456..."          # 改为你的APISecret
```

**示例：**
```python
XFYUN_APPID = "5f8a9b12"
XFYUN_API_KEY = "4c8a5d92e1f3b6a7c9d8e5f2"
XFYUN_API_SECRET = "a1b2c3d4e5f6g7h8i9j0k1l2"
```

---

## 🚀 启动和测试

### 步骤1：启动代理

```powershell
cd D:\RT-ThreadStudio\workspace\Desktop-voice-assistant\art_pi2_wifi
python xfyun_proxy.py
```

**确认显示：**
```
========================================================================
🚀 讯飞星火大模型HTTP代理服务器已启动！
========================================================================

📍 本机IP地址: 192.168.137.1
...
```

### 步骤2：编译固件（不需要修改设备代码！）

```bash
# 设备代码已经配置好了，直接编译
scons -j8
```

### 步骤3：下载并测试

```bash
# 设备应该已经连接到PC热点
msh> ifconfig
# 确认IP是 192.168.137.x

# 测试AI
msh> ai_ask 你是谁

# 期望输出：
[AI] 我是小石，一个友好的智能助手...
```

---

## 📊 讯飞星火版本对比

| 版本 | 免费额度 | 速度 | 效果 | 推荐 |
|------|---------|------|------|------|
| **Spark 3.5** | 200万tokens/月 | 快 | 最好 | ⭐⭐⭐⭐⭐ |
| Spark 3.0 | 100万tokens/月 | 快 | 好 | ⭐⭐⭐⭐ |
| Spark Lite | 500万tokens/月 | 很快 | 一般 | ⭐⭐⭐ |

**推荐使用 Spark 3.5！** 效果最好，免费额度也够用。

---

## 💰 费用说明

### 免费额度

新用户每月免费：
- **Spark 3.5**: 200万tokens
- **Spark 3.0**: 100万tokens  
- **Spark Lite**: 500万tokens

**一次对话约消耗：** 100-300 tokens

**可以对话：** 6000-20000 次/月

**完全够用！** 😊

### 超出后价格

如果免费额度用完（基本不会）：
- Spark 3.5: ¥0.036/千tokens
- 一次对话约 ¥0.003-0.01

---

## 🎯 使用示例

### 基础对话

```bash
msh> ai_ask 你是谁
→ "我是小石，一个友好的智能助手"

msh> ai_ask 今天天气怎么样
→ "抱歉，我无法获取实时天气信息"

msh> ai_ask 什么是RT-Thread
→ "RT-Thread是一个开源的实时操作系统"
```

### 知识问答

```bash
msh> ai_ask 什么是人工智能
msh> ai_ask 讲个笑话
msh> ai_ask 推荐一本书
```

---

## 🔍 故障排除

### 问题1：认证失败（401错误）

**错误：**
```
[Error] Authentication failed
```

**解决：**
1. 检查APPID、APIKey、APISecret是否正确
2. 确认已开通星火大模型服务
3. 检查是否已实名认证

### 问题2：额度不足

**错误：**
```
error_code: 10907
message: Insufficient balance
```

**解决：**
1. 查看控制台额度使用情况
2. 等待下月额度刷新
3. 或充值

### 问题3：网络连接失败

**解决：**
```bash
# 检查网络
msh> ping 192.168.137.1

# 检查代理是否运行
浏览器访问: http://192.168.137.1:8080/
```

---

## 🌟 讯飞的其他优势

### 1. 一站式语音方案

讯飞不仅有对话AI，还有：
- **语音识别**（ASR）- 可以替代音频采集
- **语音合成**（TTS）- 可以替代音频播放
- **声纹识别**
- **语音唤醒**

**未来扩展：** 可以全部用讯飞的服务，更加统一！

### 2. 中文效果最好

讯飞专门针对中文优化，对话效果比其他的都好。

### 3. 技术支持好

- 文档详细清楚
- 社区活跃
- 有专门的技术支持

---

## 📱 高级功能

### 流式输出（可选）

如果想要流式返回（逐字显示），可以修改：

```python
xfyun_data = {
    "model": XFYUN_MODEL,
    "messages": [...],
    "stream": True  # 改为True
}
```

但对嵌入式设备，建议用非流式（stream=False）。

### 多轮对话（可选）

可以保存对话历史，实现上下文对话：

```python
messages = [
    {"role": "system", "content": "..."},
    {"role": "user", "content": "第一个问题"},
    {"role": "assistant", "content": "第一个回答"},
    {"role": "user", "content": "第二个问题"},  # 带上上下文
]
```

---

## 🎓 API文档

- 官方文档：https://www.xfyun.cn/doc/spark/Web.html
- 控制台：https://console.xfyun.cn/
- 价格：https://www.xfyun.cn/doc/spark/general.html#_4-%E4%BB%B7%E6%A0%BC%E8%AF%B4%E6%98%8E

---

## 💡 最佳实践

### 1. 密钥安全

不要把密钥提交到公开仓库！

### 2. 监控额度

定期查看控制台的额度使用情况。

### 3. 优化提示词

在 `system_prompt` 中明确要求：
- 简短回答（节省tokens）
- 中文回答
- 具体的角色定位

### 4. 错误处理

代理已经内置了完善的错误处理和日志。

---

## 🚀 下一步

配置完成后，还可以：

1. **添加语音识别**
   - 用讯飞的实时语音识别API
   - 替代当前的音频采集

2. **添加语音合成**
   - 用讯飞的TTS服务
   - 让AI回复变成语音

3. **优化提示词**
   - 让AI回答更符合你的需求

4. **添加记忆功能**
   - 保存对话历史
   - 实现上下文对话

---

## 🎉 总结

**讯飞星火优势：**
- ✅ 配置简单（只需3个参数）
- ✅ 效果好（中文最强）
- ✅ 免费额度多（200万tokens）
- ✅ 速度快（国内服务器）
- ✅ 未来扩展性好（可以用讯飞全套服务）

**现在就开始：**
1. 访问 https://console.xfyun.cn/
2. 创建应用
3. 获取密钥
4. 配置代理
5. 测试！

---

**配置完成后，你就有一个完整的智能语音助手了！** 🎉

有任何问题随时问我！

