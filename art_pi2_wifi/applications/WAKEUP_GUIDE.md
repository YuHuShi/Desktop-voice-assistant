# 唤醒词功能使用指南

## 功能说明

唤醒词功能允许你通过语音来激活语音助手，无需手动按键或输入命令。

## 快速设置："Hi，小石"

### 1. 配置已完成

配置文件 `voice_assistant_config.h` 已经设置好：

```c
#define VOICE_WAKEUP_ENABLE     1          // 唤醒词功能已启用
#define VOICE_WAKEUP_WORD       "Hi小石"   // 唤醒词设置为"Hi小石"
```

### 2. 编译并运行

```bash
scons -j8          # 编译
# 下载到开发板
```

### 3. 使用方法

系统启动后会自动开启唤醒词检测：

```
======================================
  Voice Assistant Started!
  Wakeup word: Hi小石
  Say the wakeup word to activate!
======================================
```

**直接对着麦克风说："Hi，小石"** 

系统会自动：
1. 检测到唤醒词
2. 开始录音（5秒）
3. 识别你说的内容
4. AI处理并回复
5. 播放语音回复

## 工作原理

```
持续监听(2秒循环)
    ↓
语音识别
    ↓
检测是否包含"Hi小石"
    ↓ (检测到)
触发语音助手
    ↓
录音识别处理
    ↓
返回空闲状态，继续监听
```

## 命令说明

### 唤醒词控制命令

```bash
# 启动唤醒词检测（使用默认唤醒词）
wakeup_start

# 使用自定义唤醒词启动
wakeup_start 你好小智

# 停止唤醒词检测
wakeup_stop

# 查看语音助手状态
va_status
```

### 手动触发

如果不想用唤醒词，仍然可以手动触发：

```bash
va_trigger
```

## 修改唤醒词

### 方法一：修改配置文件（推荐）

编辑 `voice_assistant_config.h`：

```c
#define VOICE_WAKEUP_WORD       "你想要的唤醒词"
```

常用唤醒词示例：
- "Hi小石" ✓（已设置）
- "你好小智"
- "小爱同学"
- "小度小度"
- "天猫精灵"
- "小石助手"

### 方法二：运行时修改

```bash
# 停止当前检测
wakeup_stop

# 使用新唤醒词启动
wakeup_start 你好世界
```

## 配置选项

在 `voice_assistant_config.h` 中：

```c
/* 启用/禁用唤醒词功能 */
#define VOICE_WAKEUP_ENABLE     1    // 1=启用, 0=禁用(手动触发)

/* 设置唤醒词 */
#define VOICE_WAKEUP_WORD       "Hi小石"

/* 录音持续时间（唤醒后）*/
#define VOICE_RECORD_DURATION   5    // 秒
```

## 注意事项

### 1. 网络要求
- 唤醒词检测需要联网（使用AI识别）
- 确保WiFi连接稳定
- 建议使用高速网络以减少延迟

### 2. 唤醒词选择建议
- ✅ **推荐**：3-4个字，中英文混合（如"Hi小石"）
- ✅ **推荐**：发音清晰、易识别
- ❌ **不推荐**：过短（易误触发）
- ❌ **不推荐**：常用词语（如"你好"、"谢谢"）

### 3. 性能影响
- 唤醒词检测会持续占用：
  - 音频采集资源
  - 网络带宽（每2秒一次识别）
  - CPU资源（中等）
- 如果不需要，可以设置 `VOICE_WAKEUP_ENABLE 0` 禁用

### 4. 识别准确度
- 环境噪音会影响识别
- 说话清晰、音量适中
- 距离麦克风1米以内效果最佳

## 使用场景

### 场景1：家庭智能助手
```
你："Hi，小石"
系统：检测到唤醒词，开始录音
你："今天天气怎么样"
系统：识别 → AI处理 → 播放天气信息
```

### 场景2：免提操作
```
你在做饭，说："Hi，小石"
系统："请说..."
你："播放音乐"
系统：播放音乐
```

### 场景3：调试测试
```bash
# 禁用唤醒词，改用手动触发
va_stop
# 在配置文件设置 VOICE_WAKEUP_ENABLE 0
# 重新编译
# 使用 va_trigger 手动测试
```

## 故障排除

### 问题1：唤醒词无响应
**检查项：**
- WiFi是否连接：`ifconfig`
- 语音助手是否运行：`va_status`
- 唤醒检测是否启动：查看启动日志
- 麦克风是否正常：`audio_test start`

**解决方法：**
```bash
va_stop
va_start
```

### 问题2：误触发（频繁唤醒）
**原因：**
- 环境噪音大
- 唤醒词太常见
- 麦克风增益过高

**解决方法：**
- 更换唤醒词（选择不常用的词）
- 调整麦克风增益
- 增加环境消噪

### 问题3：识别不准确
**解决方法：**
- 清晰发音
- 调整音量
- 靠近麦克风
- 减少环境噪音

### 问题4：延迟太长
**原因：**
- 网络延迟
- AI服务响应慢

**解决方法：**
- 使用更快的网络
- 切换AI服务提供商
- 考虑本地唤醒词检测（需要额外开发）

## 高级功能（可扩展）

### 1. 本地唤醒词检测
使用嵌入式语音识别库（如：
- Porcupine（轻量级唤醒词）
- Snowboy（离线唤醒词）

优点：
- 无需联网
- 响应快速
- 省流量

### 2. 多唤醒词支持
```c
const char *wakeup_words[] = {
    "Hi小石",
    "你好小石",
    "小石助手"
};
```

### 3. 自定义唤醒行为
编辑 `voice_assistant.c` 中的 `wakeup_callback_handler()`

## 示例对话

```
[系统启动]
======================================
  Voice Assistant Started!
  Wakeup word: Hi小石
  Say the wakeup word to activate!
======================================

你："Hi，小石"

[Wakeup] 检测到唤醒词: Hi小石
[I/voice.assistant] Voice assistant triggered
[I/voice.assistant] Recording for 5 seconds...

你："今天天气怎么样"

[Voice] You said: 今天天气怎么样
[I/voice.assistant] Playing AI response...
（播放天气信息语音）

[系统返回监听状态，等待下次唤醒]
```

## 总结

✅ **已完成配置**：唤醒词设置为 "Hi小石"
✅ **自动启动**：系统启动后自动开启唤醒检测
✅ **使用简单**：直接说唤醒词即可激活

需要修改唤醒词，编辑 `voice_assistant_config.h` 中的 `VOICE_WAKEUP_WORD`！

---

**提示**：首次使用建议先用 `va_trigger` 手动测试功能是否正常，确认无误后再启用唤醒词功能。

