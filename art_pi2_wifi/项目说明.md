# RT-Thread 语音助手项目

## 📖 项目简介

基于 **ART-Pi2 开发板** 和 **讯飞星火大模型** 的智能语音助手系统。

## ✨ 主要特性

- ✅ 语音唤醒（"小石小石"）
- ✅ 语音识别（ASR）
- ✅ AI对话（讯飞星火 Ultra-32K）
- ✅ 语音合成（TTS）
- ✅ WiFi连接支持
- ✅ HTTP代理方案（解决HTTPS问题）

## 🏗️ 系统架构

```
┌─────────────┐      WiFi      ┌──────────────┐      HTTPS      ┌─────────────┐
│  ART-Pi2    │ ◄──────────► │  PC代理服务器  │ ◄──────────► │  讯飞星火API  │
│  开发板     │    HTTP       │ (xfyun_proxy) │     安全连接    │             │
└─────────────┘               └──────────────┘               └─────────────┘
```

## 📁 项目结构

```
art_pi2_wifi/
├── applications/          # 应用代码
│   ├── ai_chat_service.c  # AI对话服务
│   ├── ai_dialog_tool.c   # AI对话工具
│   ├── audio_capture.c    # 音频采集
│   ├── audio_player.c     # 音频播放
│   ├── wakeup_detector.c  # 唤醒检测
│   └── voice_assistant.c  # 语音助手主程序
├── xfyun_proxy.py        # 讯飞星火HTTP代理服务器 ⭐
├── XFYUN_SPARK_CONFIG.md # 讯飞星火配置指南 ⭐
├── 快速启动.md           # 快速启动指南 ⭐
└── HTTP_PROXY_GUIDE.md   # HTTP代理详细指南
```

## 🚀 快速开始

### 1. 配置讯飞星火API

参考文档：**[XFYUN_SPARK_CONFIG.md](XFYUN_SPARK_CONFIG.md)**

1. 注册讯飞账号：https://www.xfyun.cn/
2. 创建应用并获取APIPassword
3. 编辑 `xfyun_proxy.py`，填入你的APIPassword

### 2. 启动代理服务器

在PC上运行：

```bash
# 安装依赖
pip install flask requests

# 启动代理
cd D:\RT-ThreadStudio\workspace\Desktop-voice-assistant\art_pi2_wifi
python xfyun_proxy.py
```

### 3. 连接WiFi

开发板连接到PC热点或同一局域网。

### 4. 编译和下载固件

```bash
# 编译
scons -j8

# 下载到开发板
（使用RT-Thread Studio或命令行工具）
```

### 5. 测试

```bash
# 在开发板终端
msh> ai_ask 你是谁
```

## 📚 详细文档

- **[快速启动.md](快速启动.md)** - 快速上手指南
- **[XFYUN_SPARK_CONFIG.md](XFYUN_SPARK_CONFIG.md)** - 讯飞星火配置详解
- **[HTTP_PROXY_GUIDE.md](HTTP_PROXY_GUIDE.md)** - HTTP代理完整指南
- **[HTTPS_SOLUTION.md](HTTPS_SOLUTION.md)** - HTTPS解决方案对比
- **[AI_DIALOG_GUIDE.md](AI_DIALOG_GUIDE.md)** - AI对话功能说明
- **[VOICE_ASSISTANT_README.md](VOICE_ASSISTANT_README.md)** - 语音助手使用说明

## 🔧 开发板配置

### 硬件要求

- ART-Pi2 开发板（STM32H7R7）
- WiFi模块
- 麦克风（音频采集）
- 扬声器/DAC（音频输出）

### 网络配置

开发板需要连接到与PC相同的网络，并且能够访问PC的IP地址（通常是PC热点的网关地址，如 `192.168.137.1`）。

## 💡 核心功能

### AI对话

```c
// 使用示例
msh> ai_ask 你是谁
[AI] 我是小石，你的友好智能助手～随时为你效劳！😊

msh> ai_ask 今天天气怎么样
[AI] 抱歉，我无法获取实时天气信息...
```

### 语音唤醒

说出唤醒词 **"小石小石"** 激活语音助手。

## 🛠️ 技术栈

- **操作系统**: RT-Thread
- **开发板**: ART-Pi2 (STM32H7R7)
- **AI模型**: 讯飞星火 Ultra-32K
- **网络**: WiFi (lwIP)
- **音频**: I2S + DMA
- **代理服务器**: Python Flask

## ⚙️ 配置说明

### 代理服务器配置

编辑 `xfyun_proxy.py`：

```python
# 讯飞星火API密码（从控制台获取）
XFYUN_API_PASSWORD = "你的APIPassword"

# 模型版本
XFYUN_MODEL = "4.0Ultra"
```

### 开发板配置

编辑 `applications/ai_dialog_tool.c`：

```c
// API URL（修改为你的PC IP地址）
strncpy(chat_config.api_url, 
        "http://192.168.137.1:8080/v2/app/conversation",
        sizeof(chat_config.api_url) - 1);
```

## 🐛 故障排除

### 问题1: 网络连接失败

**解决方法：**
1. 确认开发板和PC在同一网络
2. 检查PC防火墙设置（允许8080端口）
3. ping测试PC地址

### 问题2: AI回复乱码

**解决方法：**
已在代码中实现Unicode解码，重新编译固件即可。

### 问题3: 代理服务器启动失败

**解决方法：**
1. 检查Python版本（需要3.6+）
2. 安装依赖：`pip install flask requests`
3. 检查8080端口是否被占用

## 📝 更新日志

### v1.0 (2025-10-17)
- ✅ 集成讯飞星火 Ultra-32K 模型
- ✅ 实现HTTP代理方案
- ✅ 完善Unicode解码支持
- ✅ 优化日志输出
- ✅ 整理项目结构

## 📄 许可证

本项目基于 RT-Thread 开源协议。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📞 联系方式

如有问题，请提交 Issue 或参考文档。

---

**开始你的AI语音助手之旅吧！** 🎉

